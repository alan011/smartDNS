# smartDNS设计介绍

smartDNS是一套在bind的基础上用django开发的API，将配置数据存在数据库，然后用jinja2语言来渲染模板，自动生成bind的配置文件，自动reload named服务。

这样便可基于这套API做web界面，或者跟其他运维系统做对接，自动添加DNS解析。

### 主从架构说明
smartDNS会自动生成bind所需的配置文件，故不再需要bind本身的主从同步机制。

smartDNS中主节点的接口，将接收到有配置变化的请求时（增、删、改请求），会先将数据写入数据库，然后通知所有从节点做一次配置同步。

从节点收到通知后，会自己到数据库中读取数据，在临时目录中生成一套配置文件，并跟原来的配置文件做对比，若有变化则覆盖原来的配置文件，reload named服务（主节点写完数据库后也会做这个操作）。

通过以上机制，便实现了一个dns集群内部的数据同步。
 
### 多个DNS集群数据同步架构说明
smartDNS还支持对多个DNS集群的管理（multi_cluster模式）。

一般一个机房（或者一个区）内部用一套内部DNS，即一个DNS集群，一个主节点，多个从节点。但，如果有多个机房（多个区），就有可能需要用到多个DNS集群。

smartDNS要求在每个集群的主节点（master）上起一个数据库服务，用于存储DNS配置数据。

然后配置其中一个主节点，作为控制中心，通过这个节点的接口来增、删、改、查数据，smartDNS会在多个主节点之间同步数据的修改，保证每个机房数据库中的数据是完全相同的。

不同的集群的配置数据都有集群标签（也可叫IDC标签、或区域标签），各集群的节点在生成bind配置文件时，只会读取自己集群标签的配置数据。

通过这种方式，实现了DNS集群的夸机房管理、数据同步等，也实现了数据备份与多活。

